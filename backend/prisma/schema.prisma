generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl", "linux-musl-openssl-3.0.x", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              Int      @id @default(autoincrement())
  username        String   @unique
  password        String
  name            String
  role            String   @default("staff") // 'owner' | 'staff'
  status          String   @default("active")
  availability    String   @default("idle") // 'idle' | 'busy'
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  openedShifts CashShift[]   @relation("OpenedShifts")
  closedShifts CashShift[]   @relation("ClosedShifts")
  transactions Transaction[]
  bookings     Booking[]
}

model Service {
  id              Int      @id @default(autoincrement())
  name            String
  price           Float
  commissionType  String   @default("percentage") // 'percentage' | 'flat'
  commissionValue Float    @default(0)
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Customer {
  id          Int      @id @default(autoincrement())
  name        String
  phone       String   @unique
  totalVisits Int      @default(0)
  lastVisit   DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model CashShift {
  id            Int       @id @default(autoincrement())
  openedById    Int
  closedById    Int?
  startCash     Float
  actualEndCash Float?    @default(0)
  totalRevenue  Float     @default(0) // Calculated from transactions
  status        String    @default("open") // 'open' | 'closed'
  startTime     DateTime  @default(now())
  endTime       DateTime?
  notes         String?

  // Relations
  openedBy User  @relation("OpenedShifts", fields: [openedById], references: [id])
  closedBy User? @relation("ClosedShifts", fields: [closedById], references: [id])
}

model Transaction {
  id            Int      @id @default(autoincrement())
  invoiceCode   String   @unique
  barberId      Int
  customerName  String?
  customerPhone String?
  items         Json // Stores array of {name, price, qty}
  totalAmount   Float
  paymentMethod String   @default("cash") // 'cash' | 'qris'
  date          DateTime @default(now())

  // Relations
  barber User @relation(fields: [barberId], references: [id])
}

model Expense {
  id          Int      @id @default(autoincrement())
  description String
  amount      Float
  category    String   @default("operational")
  date        DateTime @default(now())
}

model Payroll {
  id              Int      @id @default(autoincrement())
  barberId        Int
  period          String // YYYY-MM
  totalServices   Int
  totalCommission Float
  baseSalary      Float    @default(0) // If any
  bonuses         Float    @default(0)
  deductions      Float    @default(0) // Kasbon etc
  totalPayout     Float
  status          String   @default("draft") // draft, paid
  generatedAt     DateTime @default(now())
}

model Booking {
  id            Int      @id @default(autoincrement())
  barberId      Int
  barber        User     @relation(fields: [barberId], references: [id])
  customerName  String
  customerPhone String
  bookingDate   DateTime
  timeSlot      String   // e.g., "14:00 - 15:00"
  status        String   @default("pending") // pending, confirmed, cancelled, completed
  paymentProof  String?  // URL/Path to uploaded evidence
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}
